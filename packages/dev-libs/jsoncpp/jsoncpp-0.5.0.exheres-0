# Copyright 2014 Pierre Lejeune <superheron@gmail.com>
# Distributed under the terms of the GNU General Public License v2

MY_PNV="${PN}-src-${PV}"

require sourceforge [ suffix="tar.gz" ] scons
require python [ blacklist=none has_bin=true has_lib=false ]

SUMMARY="An implementation of a JSON reader and writer in C++"
DESCRIPTION="
JSON (JavaScript Object Notation) is a lightweight data-interchange format. It is easy for humans
to read and write. It is easy for machines to parse and generate.
"

LICENCES="public-domain MIT"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS="doc"

DEPENDENCIES="
    build:
        doc? ( app-doc/doxygen )
"

WORK="${WORKBASE}/${MY_PNV}"

SCONS_SRC_CONFIGURE_PARAMS=( "platform=linux-gcc" )
SCONS_SRC_COMPILE_PARAMS=( "platform=linux-gcc" )

src_test() {
    escons platform=linux-gcc check
}

# json_src_install doesn't work; doing it manually
src_install() {
    if option doc; then
        ${PYTHON} doxybuild.py --doxygen=/usr/bin/doxygen
        edo cd "${WORK}"/dist/doxygen
        docinto html
        dodoc -r ${PN}-api-html-${PV}/*
    fi

    edo cd "${WORK}"
    emagicdocs

    insinto /usr/include/${PN}
    doins -r include/json

    newlib.so buildscons/linux-gcc-*/src/lib_json/libjson_linux-gcc*libmt.so lib${PN}.so
}

