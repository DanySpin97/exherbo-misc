# Copyright 2010 Pierre Lejeune <superheron@gmail.com>
# Distributed under the terms of the GNU General Public License v2

require ant java

MY_PN="apache-${PN}"
MY_PNV="${MY_PN}-${PV}"

SUMMARY="Apache Maven - Project Management and Comprehension Tool"
DESCRIPTION="
Apache Maven is a software project management and comprehension tool. Based on the concept of a
project object model (POM), Maven can manage a project's build, reporting and documentation from a
central piece of information.
"
HOMEPAGE="http://${PN}.apache.org"
DOWNLOADS="mirror://apache/${PN}/source/${MY_PNV}-src.tar.gz"

LICENCES="Apache-2.0"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS=""

UPSTREAM_DOCUMENTATION="${HOMEPAGE}/guides/index.html"
UPSTREAM_RELEASE_NOTES="${HOMEPAGE}/docs/${PV}/release-notes.html"

WORK="${WORKBASE}/${MY_PNV}"

COMMON_PHASES_PARAMS=(
    "-D${PN}.home=${IMAGE}/usr/share/${MY_PNV}"
    "-D${PN}.repo.local=${PALUDIS_TMPDIR}/.m2/repository"
)

ANT_SRC_PREPARE_PARAMS=( "${COMMON_PHASES_PARAMS[@]}" 'pull' )
ANT_SRC_COMPILE_PARAMS=( "${COMMON_PHASES_PARAMS[@]}" )
ANT_SRC_TEST_PARAMS=( "${COMMON_PHASES_PARAMS[@]}" 'run-its' )

src_prepare() {
    sydboxcmd 'sandunbox/net'
    ant_src_prepare
    sydboxcmd 'sandbox/net'
}

src_compile() {
    sydboxcmd 'sandunbox/net'
    ant_src_compile
    sydboxcmd 'sandbox/net'
}

src_install() {
    dodir /usr/bin
    dosym /usr{/share/"${MY_PNV}",}/bin/mvn
}

