# Copyright 2009-2013 Pierre Lejeune <superheron@gmail.com>
# Distributed under the terms of the GNU General Public License v2

MY_PV="$(ever range 1-3)"
MY_PNV="${PN}-${MY_PV}"
BUILDID="$(ever range 4)"

require freedesktop-desktop freedesktop-mime gtk-icon-cache mono
require autotools [ supported_autoconf=[ 2.5 ] supported_automake=[ 1.13 1.12 1.11 ] ]

SUMMARY="Integrated Development Environment for .NET"
DESCRIPTION="
MonoDevelop is an IDE primarily designed for C# and other .NET languages.
MonoDevelop enables developers to quickly write desktop and ASP.NET Web
applications on Linux. MonoDevelop makes it easy for developers to port
.NET applications created with Visual Studio to Linux and to maintain
a single code base for all platforms.
"
HOMEPAGE="http://monodevelop.com"
DOWNLOADS="http://download.mono-project.com/sources/${PN}/${MY_PNV}-${BUILDID}.tar.bz2"

LICENCES="LGPL-2.1"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS="extensions git subversion"

DEPENDENCIES="
    build:
        dev-util/intltool
        sys-devel/gettext
        virtual/pkg-config
    build+run:
        dev-dotnet/mono-addins[>=0.6][gui]
        dev-lang/mono[>=2.10.9]
        gnome-bindings/gnome-sharp:2[>=2.12.8]
        gnome-bindings/gtk-sharp:2[>=2.12.8]
        git? ( dev-scm/git )
        subversion? ( dev-scm/subversion )
"

UPSTREAM_DOCUMENTATION="${HOMEPAGE}/Documentation"
UPSTREAM_RELEASE_NOTES="${HOMEPAGE}/Download/Release_Notes/Release_Notes_for_MonoDevelop_${MY_PV}"

WORK="${WORKBASE}/${MY_PNV}"

DEFAULT_SRC_PREPARE_PATCHES=( "${FILES}/${MY_PNV}-fix-libdir.patch" )

DEFAULT_SRC_CONFIGURE_PARAMS=(
    '--disable-update-desktopdb'
    '--disable-update-mimedb'
    '--enable-gnomeplatform'
)
DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=(
    'extensions monoextensions'
    'git'
    'subversion'
)
DEFAULT_SRC_CONFIGURE_TESTS=( '--any --enable-tests' )

DEFAULT_SRC_COMPILE_PARAMS=( '-j1' )

src_prepare() {
    # Do not look for version.config in parent directory. It's located in ${WORK}.
    edo sed -in "s/..\/version.config/version.config/g" configure.in

    autotools_src_prepare
}

# Update desktop and MIME databases at the same time
pkg_postinst() {
    freedesktop-desktop_pkg_postinst
    freedesktop-mime_pkg_postinst
    gtk-icon-cache_pkg_postinst
}

pkg_postrm() {
    freedesktop-desktop_pkg_postrm
    freedesktop-mime_pkg_postrm
    gtk-icon-cache_pkg_postrm
}

