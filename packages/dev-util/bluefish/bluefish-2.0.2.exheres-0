# Copyright 2009 Pierre Lejeune <superheron@gmail.com>
# Distributed under the terms of the GNU General Public License v2

require autotools [ supported_autoconf=[ 2.5 ] supported_automake=[ 1.11 ] ] freedesktop-desktop freedesktop-mime sourceforge

SUMMARY="Bluefish GTK+ web editor"
DESCRIPTION="
Bluefish is a powerful editor targeted towards programmers and webdesigners,
with many options to write websites, scripts and programming code. Bluefish
supports many programming and markup languages, and it focuses on editing
dynamic and interactive websites.
"

LICENCES="GPL-2"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS="charmap [[ description = [ Builds charmap plugin ] ]]
           python spell"

DEPENDENCIES="
    build:
        dev-util/intltool
        sys-devel/gettext
    build+run:
        dev-libs/libxml2
        dev-libs/pcre
        gnome-desktop/gvfs
        x11-libs/gtk+:2[>=2.12]
        x11-libs/pango
        charmap? ( gnome-extra/gucharmap[>=2.20] )
        python? ( dev-lang/python:= )
        spell? ( app-spell/enchant )
"

UPSTREAM_DOCUMENTATION="http://bluefish.openoffice.nl/manual/"

DEFAULT_SRC_PREPARE_PATCHES=( -p0 "${FILES}"/"${PNV}"-gucharmap-automagic.patch )

DEFAULT_SRC_CONFIGURE_PARAMS=( '--disable-update-databases' )
DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=(
    'charmap'
    'python'
    'spell spell-check'
)

src_prepare() {
    edo intltoolize --copy --force --automake
    for po_dir in src/plugin_*/po ; do
        edo cp po/Makefile.in.in "${po_dir}"
    done
    autotools_src_prepare
}

# Update desktop and MIME databases at the same time
pkg_postinst() {
    freedesktop-desktop_pkg_postinst
    freedesktop-mime_pkg_postinst
}

pkg_postrm() {
    freedesktop-desktop_pkg_postrm
    freedesktop-mime_pkg_postrm
}

