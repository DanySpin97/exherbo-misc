# Copyright 2010 Pierre Lejeune <superheron@gmail.com>
# Distributed under the terms of the GNU General Public License v2

require mono multilib sourceforge [ pnv=${PN}src-${PV} suffix=zip ]

SUMMARY="IKVM.NET is a Java Virtual Machine (JVM) for the .NET and Mono runtimes."
DESCRIPTION="
IKVM.NET is an implementation of Java for Mono and the Microsoft .NET Framework.
It includes the following components:

    * A Java Virtual Machine implemented in .NET
    * A .NET implementation of the Java class libraries
    * Tools that enable Java and .NET interoperability
"
HOMEPAGE="http://www.${PN}.net"

OPENJDK6_BUILD="b18"
SHARPZIPLIB_PV="0860"
DOWNLOADS="http://www.frijters.net/${PN}src-${PV}.zip
           mirror://sourceforge/${PN}/openjdk6-${OPENJDK6_BUILD}-stripped.zip"

LICENCES="ZLIB"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS=""

DEPENDENCIES="
    build:
        dev-util/nant[>=0.85]
    build+run:
        dev-lang/mono
        virtual/jdk:1.6
"

src_prepare() {
    # Use ICSharpCode.SharpZipLib from the GAC
    edo sed -i -e 's:../bin/ICSharpCode.SharpZipLib.dll:ICSharpCode.SharpZipLib.dll:' \
        ikvmc/ikvmc.build ikvmstub/ikvmstub.build
}

src_compile() {
    edo nant -t:mono-2.0 clean
    edo nant -t:mono-2.0
}

src_install() {
    insinto "/usr/$(get_libdir)/${PN}"
    doins -r "${WORK}/bin"

    dodir '/usr/bin'
    for bin in ikvm{,c,stub}; do
        dosym "/usr/$(get_libdir)/${PN}/bin/${bin}.exe" "/usr/bin/${bin}"
    done
}

